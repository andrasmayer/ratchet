<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>WebSocket teszt</title>
</head>
<body>
    <textarea class="user" >user</textarea>
    <textarea class="message" placeholder="Írj üzenetet..."></textarea>
    <div class="userList"></div>

    <script>
        // Kapcsolat indítása
        var conn = new WebSocket('ws://192.168.141.184:8091/chat')

        conn.onopen = function () {
            console.log("onopen")
            console.log( JSON.parse(auth() ) )

        }

        conn.onerror = function (error) {
            console.error("WebSocket hiba:", error)
        }

        conn.onmessage = function (e) {
            console.log( e.data)
            //getOnlineUsers()
        }





        const getOnlineUsers = () =>{
            //console.log("Aktív ")
            conn.send(JSON.stringify({ type: "getOnlineUsers"}));
        }

        



        const message = document.querySelector(".message")
        message.addEventListener("keyup", function (e) {
                if(e.keyCode == 13){
                    //console.log(message.value)
                    //conn.send({message:message.value, type:"chat"})
                    conn.send(JSON.stringify({ type: "globalMessage", message: message.value, from:ratchetUserToken, to:null}));
                }
        })


        const auth = ()=>{
            conn.send(JSON.stringify({ type: "auth", user:ratchetUserToken}));
        }
        

        let ratchetUserToken = localStorage.getItem("ratchetUserToken")
        
        const user = document.querySelector(".user")
        user.addEventListener("keyup", function (e) {
                if(e.keyCode == 13){
                    localStorage.setItem("ratchetUserToken",user.value)
                    ratchetUserToken = user.value
                    auth()
                    //console.log("belépés")
                    
                }
        })

    </script>
</body>
</html>
